"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[14],{4318:function(e,t,a){a.d(t,{Fh:function(){return u},bu:function(){return s},Gw:function(){return o},aU:function(){return l},Z1:function(){return r},u3:function(){return d},wt:function(){return i}}),a(6624);var n=a(7014);let r=async()=>{},o=async()=>(await fetch((0,n.l9)("/settings"))).json(),i=async(e,t)=>{await fetch((0,n.l9)("/settings/".concat(e)),{method:"POST",body:JSON.stringify(t)})},l=async()=>(await fetch((0,n.l9)("/object_info"))).json(),s=async e=>{await fetch((0,n.l9)("/queue"),{method:"POST",body:JSON.stringify({delete:[e]})})},d=async e=>{let t=await fetch((0,n.l9)("/prompt"),{method:"POST",body:JSON.stringify(e)});return{error:200!==t.status?await t.text():void 0}},c=e=>{let t=e.map(t=>{if("*"===t.sourceHandle){let a=e.find(e=>e.target===t.source);return{...t,source:a.source,sourceHandle:a.sourceHandle}}return t});return t.find(e=>"*"===e.sourceHandle)?c(t):t.filter(e=>"*"!==e.targetHandle)},u=e=>{let{graph:t,widgets:a,customWidgets:r,clientId:o}=e,i={},l={};Object.entries(t.data).forEach(e=>{let[t,o]=e;if(r.includes(o.value.widget))return;let s={...o.value.fields};Object.entries(s).forEach(e=>{let[t,r]=e,i=a[o.value.widget].input.required[t];n.lj.isInt(i)&&i[1].randomizable&&-1===r&&(s[t]=Math.trunc(Math.random()*Number.MAX_SAFE_INTEGER))}),l[t]={position:o.position,value:{...o.value,fields:s}},i[t]={class_type:o.value.widget,inputs:s}});let s=c(t.connections);return s.forEach(e=>{let n=t.data[e.source];if(!n)return;let r=a[n.value.widget].output.findIndex(t=>t===e.sourceHandle);i[e.target]&&(i[e.target].inputs[e.targetHandle]=[e.source,r])}),{prompt:i,client_id:o,extra_data:{extra_pnginfo:{workflow:{connections:s,data:l}}}}}},6624:function(e,t){t.Z={host:"127.0.0.1:8188",protocol:"http:"}},9326:function(e,t){t.Z={data:{"687e2c5c-cd33-49ae-b1a6-289cf1fdd0ff":{value:{widget:"PreviewImage",fields:{}},position:{x:1566.6656859977622,y:1241.962884856701},width:296,height:142},"d6488046-7e3d-45ce-b0cb-fc461ded790d":{value:{widget:"VAELoader",fields:{vae_name:"vae-ft-mse-840000-ema-pruned.safetensors"}},position:{x:789.4195199284518,y:1662.4628083814446},width:319,height:120},"2d69027b-18cb-4fba-a6f7-3cc6191da27a":{value:{widget:"EmptyLatentImage",fields:{width:512,height:512,batch_size:1}},position:{x:450.1747371550397,y:1618.5429203591423},width:240,height:246},"df10802c-dcb3-45cb-b61a-ed21c9435e54":{value:{widget:"VAEDecode",fields:{}},position:{x:1193.2869359712133,y:1125.515155272075},width:240,height:96},"3ab52db7-7835-409b-9742-cdbb84283789":{value:{widget:"KSampler",fields:{seed:13316703440321622e3,steps:24,cfg:8,sampler_name:"dpm_2",scheduler:"normal",denoise:.99}},position:{x:852.5481575303295,y:1036.0737133524628},width:240,height:461},"03e009af-40ce-40f8-8678-ee811fe31f41":{value:{widget:"CLIPTextEncode",fields:{text:"(worst quality:1.2), (low quality:1.2)"},modify:{nickname:"Negative"}},position:{x:364.94750305419154,y:1238.9188592484923},width:280,height:228},"18d73b78-7fd7-4411-a39e-b8a17e677892":{value:{widget:"CLIPTextEncode",fields:{text:"best quality,masterpiece,highres,original,extremely detailed wallpaper,perfect lighting,extremely detailed CG,blurry background, pbcmf,bodysuit,cleavage,pink hair,coif,bcmf,jacket,red hair,black coif"},modify:{nickname:"Positive"}},position:{x:365.1056570095522,y:829.0623046524952},width:278,height:154},"1ab1ba4a-5dfb-4ced-bc06-2b55af930969":{value:{widget:"CheckpointLoaderSimple",fields:{ckpt_name:"Aniverse.safetensors"}},position:{x:-269.3325424523291,y:1036.3999742057622},width:317,height:148}},connections:[{source:"1ab1ba4a-5dfb-4ced-bc06-2b55af930969",sourceHandle:"MODEL",target:"3ab52db7-7835-409b-9742-cdbb84283789",targetHandle:"model"},{source:"1ab1ba4a-5dfb-4ced-bc06-2b55af930969",sourceHandle:"CLIP",target:"18d73b78-7fd7-4411-a39e-b8a17e677892",targetHandle:"clip"},{source:"1ab1ba4a-5dfb-4ced-bc06-2b55af930969",sourceHandle:"CLIP",target:"03e009af-40ce-40f8-8678-ee811fe31f41",targetHandle:"clip"},{source:"03e009af-40ce-40f8-8678-ee811fe31f41",sourceHandle:"CONDITIONING",target:"3ab52db7-7835-409b-9742-cdbb84283789",targetHandle:"negative"},{source:"18d73b78-7fd7-4411-a39e-b8a17e677892",sourceHandle:"CONDITIONING",target:"3ab52db7-7835-409b-9742-cdbb84283789",targetHandle:"positive"},{source:"2d69027b-18cb-4fba-a6f7-3cc6191da27a",sourceHandle:"LATENT",target:"3ab52db7-7835-409b-9742-cdbb84283789",targetHandle:"latent_image"},{source:"3ab52db7-7835-409b-9742-cdbb84283789",sourceHandle:"LATENT",target:"df10802c-dcb3-45cb-b61a-ed21c9435e54",targetHandle:"samples"},{source:"d6488046-7e3d-45ce-b0cb-fc461ded790d",sourceHandle:"VAE",target:"df10802c-dcb3-45cb-b61a-ed21c9435e54",targetHandle:"vae"},{source:"df10802c-dcb3-45cb-b61a-ed21c9435e54",sourceHandle:"IMAGE",target:"687e2c5c-cd33-49ae-b1a6-289cf1fdd0ff",targetHandle:"images"}]}},36:function(e,t,a){a.d(t,{Uh:function(){return r},oy:function(){return o}});var n=a(7437);let r={"":"",red:"#FF0000",orange:"#FFA500",yellow:"#FFFF00",green:"#00FF00",cyan:"#00FFFF",blue:"#0000FF",indigo:"#4B0082",purple:"#800080",pink:"#FFC0CB"},o=["","red","orange","yellow","green","cyan","blue","indigo","purple","pink"].map((e,t)=>({label:(0,n.jsx)("div",{style:{background:r[e]||"#eee",width:16,height:16,borderRadius:"50%"}}),name:e,key:t}))},6042:function(e,t,a){a.d(t,{f:function(){return et},Z:function(){return ea}});var n=a(7437),r=a(2265),o=a(5087),i=a(1774),l=a(970),s=a(5179),d=a(36),c=a(7827),u=a(1657);let f=r.forwardRef((e,t)=>{let{className:a,value:r,...o}=e;return(0,n.jsx)(c.fC,{ref:t,className:(0,u.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...o,children:(0,n.jsx)(c.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});f.displayName=c.fC.displayName;var p=a(7014),m=a(703),g=a(3666),h=r.memo(e=>{let{data:t}=e,[a,o]=(0,r.useState)(!1),i=(0,r.useCallback)(e=>{let{image:t,index:a}=e;return(0,n.jsx)(m.default,{width:500,height:500,alt:"image",src:(0,p.l9)(g.Z.stringifyUrl({url:"/view",query:t})),onError:()=>o(!0),unoptimized:!0},a)},[]);return!t||0===t.length||a?null:(0,n.jsx)("div",{children:t.map(i).reverse()})}),x=a(3606),v=a(6816),b=a(5849),y=a(6093),w=a(6376);function N(){let e=(0,y._)(["\n          outline: 2px solid ",";\n        "]);return N=function(){return e},e}function j(){let e=(0,y._)(["\n  min-width: 80px;\n  height: 100%;\n  min-height: 120px;\n\n  ",";\n  .react-flow__resize-control {\n    pointer-events: all !important;\n  }\n"]);return j=function(){return e},e}function k(){let e=(0,y._)(["\n  text-align: ",";\n  .react-flow__handle {\n    top: unset;\n    margin-top: 10px;\n  }\n"]);return k=function(){return e},e}w.ZP.div(j(),e=>{let{active:t,theme:a}=e;return t?(0,w.iv)(N(),a.colorPrimary):""});let C=w.ZP.div(k(),e=>{let{position:t}=e;return t});var R=e=>{var t;let{label:a,type:i,position:s,slotType:d,isRequired:c}=e,u=(0,l.q)((0,o.N)(e=>e.nodes)),f=(0,r.useCallback)(e=>{if("*"===e.targetHandle||"*"===e.sourceHandle)return!0;try{var t;let a=null===(t=u.find(t=>t.id===e.target))||void 0===t?void 0:t.data.input.required[String(e.targetHandle)][0];(0,v.Z)(a)&&(a="STRING");let n=e.sourceHandle;return a===n}catch(e){return!0}},[u]);return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(C,{position:s,isRequired:c?1:0,children:[c?(0,n.jsx)(x.HH,{id:a,type:i,position:s,isValidConnection:f,style:{width:"12px",height:"12px",boxShadow:"0px 0px 12px rgba(72, 66, 66, 0.4)"}}):null,(0,n.jsx)("h5",{className:"mb-1",title:Array.isArray(d)?"STRING":d,children:(0,b.Z)(null===(t=a.toLowerCase)||void 0===t?void 0:t.call(a))})]})})},F=r.memo(e=>{let{data:t}=e;return(null==t?void 0:t.length)?(0,n.jsx)("div",{className:"flex-1",children:t.map(e=>{let{name:t,type:a}=e;return(0,n.jsx)(R,{slotType:a,label:t,type:"target",position:x.Ly.Left,isRequired:!0},t)})}):(0,n.jsx)("div",{})}),I=r.memo(e=>{let{data:t}=e;return(null==t?void 0:t.length)?(0,n.jsx)("div",{className:"flex-1",children:t.map(e=>(0,n.jsx)(R,{slotType:e,label:e,type:"source",position:x.Ly.Right,isRequired:!0},e))}):(0,n.jsx)("div",{})}),S=a(6969),L=a(9259);let E=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(S.fC,{ref:t,className:(0,u.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...r,children:(0,n.jsx)(S.z$,{className:(0,u.cn)("flex items-center justify-center text-current"),children:(0,n.jsx)(L.Z,{className:"h-4 w-4"})})})});E.displayName=S.fC.displayName;var M=a(4228),_=a(5509),O=a(9842),Z=r.memo(e=>{var t;let{value:a,input:i,onChange:d,name:c}=e,[u,f]=(0,r.useState)([]),{onRefresh:p,widgets:m}=(0,l.q)((0,o.N)(e=>({onRefresh:e.onRefresh,widgets:e.widgets})));return(0,r.useEffect)(()=>{var e,t,a,n,r;let{LoadImage:o}=m,l="image"===c?null==o?void 0:null===(a=o.input)||void 0===a?void 0:null===(t=a.required)||void 0===t?void 0:null===(e=t.image)||void 0===e?void 0:e[0]:null==i?void 0:i[0];f([...null!==(n=null==l?void 0:l.filter(e=>!e.includes("\\")).map(e=>({value:e,label:e})))&&void 0!==n?n:[],...Object.entries(null!==(r=null==l?void 0:l.filter(e=>e.includes("\\")).reduce((e,t)=>{let[a,n]=t.split("\\");return e[a]||(e[a]=[]),e[a].push({value:t,label:n}),e},{}))&&void 0!==r?r:{}).map(e=>{let[t,a]=e;return{label:t,options:a}})])},[i,c,m]),(0,r.useCallback)(e=>{var t;"done"===e.file.status&&p();let a=null===(t=e.file.response)||void 0===t?void 0:t.name;a&&d(a)},[d,p]),(0,n.jsxs)(n.Fragment,{children:["image"===c&&(0,n.jsxs)("div",{className:"grid w-full max-w-sm items-center gap-1.5",children:[(0,n.jsx)(O._,{htmlFor:"picture",children:"Picture"}),(0,n.jsx)(s.I,{id:"picture",type:"file"})]}),(0,n.jsxs)(_.Ph,{defaultValue:a||(null===(t=u[0])||void 0===t?void 0:t.value),onValueChange:d,children:[(0,n.jsx)(_.i4,{className:"w-full",children:(0,n.jsx)(_.ki,{placeholder:"Select"})}),(0,n.jsx)(_.Bw,{children:u.map(e=>(0,n.jsx)(_.Ql,{value:e.value,children:e.label},e.value))})]})]})}),P=r.memo(e=>{let{name:t,value:a,min:i,max:d,step:c,style:u,onChange:f}=e,p=(0,l.q)((0,o.N)(e=>e.counter)),[m,g]=(0,r.useState)(a),[h,x]=(0,r.useState)(!1),v="seed"===t,{iMax:b,iMin:y,iStep:w}=(0,r.useMemo)(()=>{let e=d,a=i,n=null!=c?c:1;switch(t){case"steps":e=200;break;case"cfg":e=32,n=.5;break;case"width":case"height":e=4096,a=512,n=4}return{iMax:e,iMin:a,iStep:n}},[t,d,i,c]),N=(0,r.useCallback)(e=>{e.stopPropagation();let t=Number(e.target.value);isNaN(t)||(g(t),f(t))},[f]);return(0,r.useCallback)(e=>{x(e.target.checked),console.log(e.target.checked)},[]),(0,r.useEffect)(()=>{v&&h&&N(Math.floor(Math.random()*b))},[p,b]),(0,n.jsx)("div",{style:u,children:(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)(s.I,{type:"number",min:y,max:b,step:w,value:Number(m),onChange:e=>N(e),onBlur:e=>N(e),className:"nodrag min-w-[100px]"})})})});let T=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("textarea",{className:(0,u.cn)("flex min-h-[80px] shadow-sm w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...r})});T.displayName="Textarea";var z=a(5754),H=a(202);let W=r.memo(e=>{let{className:t,...a}=e,o=(0,r.useMemo)(()=>Array(30).fill(1),[]),i=(0,r.useMemo)(()=>Array(30).fill(1),[]),l=(0,r.useMemo)(()=>["--sky-300","--pink-300","--green-300","--yellow-300","--red-300","--purple-300","--blue-300","--indigo-300","--violet-300"],[]),s=()=>l[Math.floor(Math.random()*l.length)];return(0,n.jsx)("div",{style:{transform:"translate(-40%,-60%) skewX(-48deg) skewY(14deg) scale(0.675) rotate(0deg) translateZ(0)"},className:(0,u.cn)("absolute left-1/3 p-4 -top-1/4 flex  -translate-x-1/2 -translate-y-1/2 w-full h-full z-0 ",t),...a,children:o.map((e,t)=>(0,n.jsx)(H.E.div,{className:"w-16 h-8  border-l  border-slate-700 relative",children:i.map((e,a)=>(0,n.jsx)(H.E.div,{whileHover:{backgroundColor:"var(".concat(s(),")"),transition:{duration:0}},animate:{transition:{duration:2}},className:"w-16 h-8  border-r border-t border-slate-100 dark:border-slate-800 relative",children:a%2==0&&t%2==0?(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"absolute h-6 w-10 -top-[14px] -left-[22px] text-slate-700 stroke-[1px] pointer-events-none",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v12m6-6H6"})}):null},"col"+a))},"row"+t))})});var A=a(5400),q=a(2177);let B=r.memo(e=>{let{type:t,models:a,value:o,onChange:i}=e,[l,s]=(0,r.useState)(!1);return(0,n.jsxs)(A.yo,{open:l,onOpenChange:s,children:[(0,n.jsx)(A.aM,{asChild:!0,children:(0,n.jsx)(z.z,{variant:"outline",className:"w-full",children:(0,n.jsx)("span",{className:"truncate",children:o||"Select"})})}),(0,n.jsxs)(A.ue,{className:"h-[80vh]",side:"bottom",onContextMenu:e=>e.preventDefault(),children:[(0,n.jsxs)("div",{className:"mx-auto w-full py-4 px-32 overflow-y-scroll",children:[(0,n.jsxs)("div",{className:"relative w-full overflow-hidden bg-background flex flex-col justify-start pt-20 pb-14",children:[(0,n.jsx)("div",{className:"absolute inset-0 w-full h-full bg-background z-20 pointer-events-none",style:{maskImage:"radial-gradient(circle at center, transparent, white 80%)"}}),(0,n.jsx)(W,{}),(0,n.jsxs)("h1",{className:"w-fit md:text-4xl text-xl font-semibold relative z-20",children:[{ckpt_name:"Checkpoint",lora_name:"Lora"}[t]," Models"]}),(0,n.jsx)("p",{className:"w-fit text-muted-foreground font-light mt-2 relative z-20 tracking-wide",children:"Select a model to use in the workflow."})]}),(0,n.jsxs)("div",{className:"w-fit md:text-4xl text-xl font-semibold absolute right-[15%] top-[20%] z-20",children:[(0,n.jsx)("input",{name:"search",type:"text",className:"px-9 flex h-6 w-full rounded-md border border-input bg-black text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Search...",onKeyDown:e=>e.stopPropagation()}),(0,n.jsx)("div",{className:"absolute inset-y-0 left-0 pl-2   flex items-center   pointer-events-none",children:(0,n.jsx)(q._Ve,{className:"w-4 h-4 text-gray-400"})})]}),(0,n.jsx)("div",{className:"flex mb-12 w-full h-[1px] bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-800 to-transparent"})]}),a.length>0&&(0,n.jsx)("div",{className:"-mt-10",children:(0,n.jsx)("div",{className:"grid grid-cols-4 gap-1",children:a.map((e,t)=>(0,n.jsx)(z.z,{variant:"ghost",size:"sm",className:"text-xs",onClick:()=>{s(!1),i(e)},children:e},t))})})]})]})});var V=r.memo(e=>{var t;let{id:a,name:i,input:d}=e,{graph:c,onPropChange:u}=(0,l.q)((0,o.N)(e=>({graph:e.graph,onPropChange:e.onPropChange}))),f=null===(t=c[a])||void 0===t?void 0:t.fields[i],m=(0,r.useMemo)(()=>(0,M.Z)(e=>{var t;u(a,i,(null==e?void 0:null===(t=e.target)||void 0===t?void 0:t.value)?e.target.value:e)},100),[a,i,u]);return p.lj.isList(d)?"ckpt_name"===i||"lora_name"===i?(0,n.jsx)(B,{value:f,models:d.flat(),type:i,onChange:m}):(0,n.jsx)(Z,{value:f,name:i,input:d,onChange:m}):p.lj.isList(d)?(0,n.jsx)(Z,{value:f,name:i,input:d,onChange:m}):p.lj.isBool(d)?(0,n.jsx)(E,{value:f,defaultChecked:d[1].default,onChange:m}):p.lj.isInt(d)?(0,n.jsx)(P,{name:i.toLowerCase(),style:{width:"100%"},value:Number(null!==f?f:d[1].default),max:Number(d[1].max),min:Number(d[1].min),onChange:e=>{var t;return m(Number((null==e?void 0:null===(t=e.target)||void 0===t?void 0:t.value)?e.target.value:e))}}):p.lj.isFloat(d)?(0,n.jsx)(P,{name:i.toLowerCase(),style:{width:"100%"},step:.01,value:Number(null!==f?f:d[1].default),max:Number(d[1].max),min:Number(d[1].min),onChange:e=>{var t;return m(Number((null==e?void 0:null===(t=e.target)||void 0===t?void 0:t.value)?e.target.value:e))}}):p.lj.isString(d)?!0===d[1].multiline?(0,n.jsx)(T,{style:{height:128,width:"100%"},defaultValue:f,onBlur:m,onKeyDown:e=>e.stopPropagation()}):(0,n.jsx)(s.I,{style:{width:"100%"},value:f,onChange:m,onKeyDown:e=>e.stopPropagation()}):null}),D=r.memo(e=>{let{data:t,nodeId:a}=e;return(null==t?void 0:t.length)?(0,n.jsx)("div",{className:"space-y-2",children:t.map((e,t)=>{let{name:r,type:o,input:i}=e;return(0,n.jsxs)("div",{className:"grid ".concat("text"===r?"grid-cols-1":"grid-cols-2"," items-center gap-2"),children:["text"!==r&&(0,n.jsx)(R,{slotType:o,label:r,type:"target",position:x.Ly.Left,isRequired:!1}),(0,n.jsx)(V,{name:r,id:a,input:i})]},r)})}):null}),U=a(146),G=a(3441);let J=U.fC,Y=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(U.ck,{ref:t,className:a,...r})});Y.displayName="AccordionItem";let K=r.forwardRef((e,t)=>{let{className:a,children:r,...o}=e;return(0,n.jsx)(U.h4,{className:"flex",children:(0,n.jsxs)(U.xz,{ref:t,className:(0,u.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",a),...o,children:[r,(0,n.jsx)(G.Z,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});K.displayName=U.xz.displayName;let X=r.forwardRef((e,t)=>{let{className:a,children:r,...o}=e;return(0,n.jsx)(U.VY,{ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...o,children:(0,n.jsx)("div",{className:(0,u.cn)("pb-4 pt-0",a),children:r})})});X.displayName=U.VY.displayName;var $=r.memo(e=>{let{id:t,data:{input:a,output:i}}=e,{imagePreviews:s,inputImgPreviews:d}=(0,l.q)((0,o.N)(e=>{var a,n,r;return{imagePreviews:null===(r=e.graph)||void 0===r?void 0:null===(n=r[t])||void 0===n?void 0:null===(a=n.images)||void 0===a?void 0:a.map((e,t)=>({image:e,index:t})).filter(Boolean),inputImgPreviews:[{image:{filename:e.onGetNodeFieldsData(t,"image"),type:"input"},index:0}].filter(e=>e.image.filename)}})),c=(0,r.useMemo)(()=>{let e=[];return Object.entries(a.required).forEach(t=>{let[a,n]=t;p.lj.isParameterOrList(n)&&e.push({name:a,type:n[0],input:n})}),e},[a]),u=(0,r.useMemo)(()=>{let e=[];return Object.entries(a.required).forEach(t=>{let[a,n]=t;p.lj.isParameterOrList(n)||e.push({name:a,type:n[0]})}),e},[a]),{expanded:f,onExpand:m}=(0,l.q)(e=>({expanded:e.expanded,onExpand:e.onExpand})),g=f.includes(t);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-stretch justify-stretch w-full space-x-6",children:[(0,n.jsx)(F,{data:u}),(0,n.jsx)(I,{data:i})]}),c.length>0&&(0,n.jsx)(J,{type:"multiple",value:g?[t]:[],onValueChange:()=>m(t),children:(0,n.jsxs)(Y,{value:t,children:[(0,n.jsx)(K,{children:"Parameters"}),(0,n.jsx)(X,{className:"m-0.5",children:(0,n.jsx)(D,{data:c,nodeId:t})})]})}),(0,n.jsx)(h,{data:s||d})]})}),Q=a(8325),ee=a(9655);let et="sdNode";var ea=r.memo(e=>{var t;let a=(0,r.useRef)(null),c=(0,r.useRef)(null),{theme:u}=(0,i.F)(),[p,m]=(0,r.useState)(!1),{progressBar:g,onDuplicateNode:h,onDeleteNode:x,onModifyChange:v}=(0,l.q)((0,o.N)(t=>{var a;return{progressBar:(null===(a=t.nodeInProgress)||void 0===a?void 0:a.id)===e.id?t.nodeInProgress.progress:void 0,onDuplicateNode:t.onDuplicateNode,onDeleteNode:t.onDeleteNode,onModifyChange:t.onModifyChange}})),b=void 0!==g;e.selected;let y=(null===(t=e.data)||void 0===t?void 0:t.nickname)||e.data.name;e.data.name;let w=t=>{let a=t.target.value;v(e.id,"nickname",a),m(!1)},N=t=>{v(e.id,"color",t)};return(0,r.useEffect)(()=>{a.current&&(a.current.parentNode.setAttribute("type",e.data.name),a.current.setAttribute("type",e.data.name))},[e.data.name]),(0,r.useEffect)(()=>{p&&c.current&&c.current.focus()},[p]),(0,n.jsxs)(ee.xV,{children:[(0,n.jsx)(ee.W4,{children:(0,n.jsx)(Q.Z,{active:b,title:(0,n.jsx)(()=>(0,n.jsxs)("div",{className:"grid grid-cols-2 items-center w-full",children:[p?(0,n.jsx)(s.I,{ref:c,defaultValue:y,onKeyDown:e=>{"Backspace"===e.key&&e.stopPropagation()},onBlur:w,className:"nodrag"}):(0,n.jsx)("div",{className:"w-fit inline-flex h-9 px-4 ".concat(b?"animate-shimmer":""," text-sm items-center justify-center rounded-full border border-opacity-40 dark:border-slate-800 bg-[linear-gradient(110deg,rgba(240,241,243,0.5),45%,rgba(254,254,254,0.5),55%,rgba(240,241,243,0.5))] dark:bg-[linear-gradient(110deg,rgba(0,1,3,0.5),45%,rgba(30,38,49,0.5),55%,rgba(0,1,3,0.5))] bg-[length:200%_100%]"),children:y}),b?g>0&&(0,n.jsx)(f,{className:"h-2 w-full border",value:Math.floor(100*g)}):null]}),{}),node:e,children:(0,n.jsx)($,{...e})})}),(0,n.jsxs)(ee.h_,{className:"w-48",children:[(0,n.jsxs)(ee.Zo,{onClick:()=>m(!0),className:"gap-1 text-xs",children:[(0,n.jsx)(q.JtS,{}),"Rename"]},"rename"),(0,n.jsxs)(ee.qu,{children:[(0,n.jsxs)(ee.xx,{className:"gap-2 text-xs",children:[(0,n.jsx)(q.vfO,{}),"Colors"]}),(0,n.jsx)(ee.dp,{children:d.oy.map((e,t)=>(0,n.jsxs)(ee.Zo,{className:"gap-2 text-xs",onClick:()=>N(e.name),children:[e.name?e.label:"None",e.name.charAt(0).toUpperCase()+e.name.slice(1)]},t))})]},"colors"),(0,n.jsx)(ee.uP,{}),(0,n.jsxs)(ee.Zo,{onClick:()=>h(e.id),className:"gap-1 text-xs",children:[(0,n.jsx)(q.TIy,{}),"Copy"]},"copy"),(0,n.jsxs)(ee.Zo,{onClick:()=>x(e.id),className:"gap-1 text-xs",children:[(0,n.jsx)(q.XHJ,{}),"Delete"]},"delete")]})]})})},8325:function(e,t,a){a.d(t,{Z:function(){return m}});var n=a(7437),r=a(2265),o=a(1657);let i=r.forwardRef((e,t)=>{let{className:a,active:r,...i}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",{"active-class":r},a),...i})});i.displayName="Card";let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",a),...r})});l.displayName="CardHeader",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("h3",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})}).displayName="CardTitle",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("p",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",a),...r})}).displayName="CardDescription";let s=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",a),...r})});s.displayName="CardContent",r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",a),...r})}).displayName="CardFooter";var d=a(202),c=a(3540),u=a(1774),f=a(36);let p={TOP:"radial-gradient(20.7% 50% at 50% 0%, hsl(0, 0%, 100%) 0%, rgba(255, 255, 255, 0) 100%)",LEFT:"radial-gradient(16.6% 43.1% at 0% 50%, hsl(0, 0%, 100%) 0%, rgba(255, 255, 255, 0) 100%)",BOTTOM:"radial-gradient(20.7% 50% at 50% 100%, hsl(0, 0%, 100%) 0%, rgba(255, 255, 255, 0) 100%)",RIGHT:"radial-gradient(16.2% 41.199999999999996% at 100% 50%, hsl(0, 0%, 100%) 0%, rgba(255, 255, 255, 0) 100%)"};var m=r.memo(e=>{var t;let{active:a,title:m,preview:g=!1,node:h,children:x}=e,{theme:v}=(0,u.F)(),[b,y]=(0,r.useState)(!0),[w,N]=(0,r.useState)("TOP"),j=a?"shadow-lg":"",k=(null==h?void 0:null===(t=h.data)||void 0===t?void 0:t.color)||"",C="light"===v?"white":"black";return(0,n.jsxs)(i,{className:(0,o.cn)("".concat(j," drag-handle relative hover:shadow-lg"),"rounded-xl transition duration-200 overflow-visible"),onMouseEnter:e=>{y(!0)},style:{background:k?"radial-gradient(circle at 0% -50%, ".concat(f.Uh[k]," 0%, ").concat(C," 50%, ").concat(C," 100%)"):C},children:[(0,n.jsxs)(l,{style:{position:"relative",padding:"1rem 1.25rem",borderTopLeftRadius:"0.75rem",borderTopRightRadius:"0.75rem",zIndex:10,transition:"all 200ms",overflow:"visible"},children:[m,!g&&(0,n.jsx)(c.KP,{position:"right",variant:"line",style:{borderWidth:"5px",borderColor:"transparent"}})]}),(0,n.jsx)(s,{style:{position:"relative",height:"100%",width:"100%",paddingTop:"1.25rem",zIndex:10,borderBottomLeftRadius:"0.75rem",borderBottomRightRadius:"0.75rem"},children:x}),a&&(0,n.jsx)(d.E.div,{className:(0,o.cn)("flex-none inset-0 overflow-hidden absolute z-0 rounded-[inherit]"),style:{filter:"blur(2px)",position:"absolute",width:"100%",height:"100%"},initial:{background:p[w]},animate:{background:b?[p[w],"radial-gradient(75% 181.15942028985506% at 50% 50%, #3275F8 0%, rgba(255, 255, 255, 0) 100%)"]:p[w]},transition:{ease:"linear",duration:1}})]})})},5754:function(e,t,a){a.d(t,{z:function(){return d}});var n=a(7437),r=a(2265),o=a(9143),i=a(7742),l=a(1657);let s=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium active:scale-95 scale-100 transition duration-200 focus-visible:outline-none focus-visible:ring-0 focus-visible:ring-none disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:a,variant:r,size:i,asChild:d=!1,...c}=e,u=d?o.g7:"button";return(0,n.jsx)(u,{className:(0,l.cn)(s({variant:r,size:i,className:a})),ref:t,...c})});d.displayName="Button"},9655:function(e,t,a){a.d(t,{W4:function(){return u},Zo:function(){return h},dp:function(){return m},h_:function(){return g},qu:function(){return f},uP:function(){return x},xV:function(){return c},xx:function(){return p}});var n=a(7437),r=a(2265),o=a(5931),i=a(7805),l=a(9259),s=a(7501),d=a(1657);let c=o.fC,u=o.xz;o.ZA,o.Uv;let f=o.Tr;o.Ee;let p=r.forwardRef((e,t)=>{let{className:a,inset:r,children:l,...s}=e;return(0,n.jsxs)(o.fF,{ref:t,className:(0,d.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",r&&"pl-8",a),...s,children:[l,(0,n.jsx)(i.Z,{className:"ml-auto h-4 w-4"})]})});p.displayName=o.fF.displayName;let m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(o.tu,{ref:t,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})});m.displayName=o.tu.displayName;let g=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(o.Uv,{children:(0,n.jsx)(o.VY,{ref:t,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in adata-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})})});g.displayName=o.VY.displayName;let h=r.forwardRef((e,t)=>{let{className:a,inset:r,...i}=e;return(0,n.jsx)(o.ck,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",a),...i})});h.displayName=o.ck.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,checked:i,...s}=e;return(0,n.jsxs)(o.oC,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:i,...s,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(o.wU,{children:(0,n.jsx)(l.Z,{className:"h-4 w-4"})})}),r]})}).displayName=o.oC.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...i}=e;return(0,n.jsxs)(o.Rk,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...i,children:[(0,n.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(o.wU,{children:(0,n.jsx)(s.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=o.Rk.displayName,r.forwardRef((e,t)=>{let{className:a,inset:r,...i}=e;return(0,n.jsx)(o.__,{ref:t,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold text-foreground",r&&"pl-8",a),...i})}).displayName=o.__.displayName;let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(o.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-border",a),...r})});x.displayName=o.Z0.displayName},5179:function(e,t,a){a.d(t,{I:function(){return i}});var n=a(7437),r=a(2265),o=a(1657);let i=r.forwardRef((e,t)=>{let{className:a,type:r,...i}=e;return(0,n.jsx)("input",{type:r,className:(0,o.cn)("flex h-10 w-full shadow-sm rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...i})});i.displayName="Input"},9842:function(e,t,a){a.d(t,{_:function(){return d}});var n=a(7437),r=a(2265),o=a(4602),i=a(7742),l=a(1657);let s=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(o.f,{ref:t,className:(0,l.cn)(s(),a),...r})});d.displayName=o.f.displayName},5509:function(e,t,a){a.d(t,{Bw:function(){return h},Ph:function(){return c},Ql:function(){return x},i4:function(){return p},ki:function(){return u}});var n=a(7437),r=a(2265),o=a(8178),i=a(3441),l=a(5159),s=a(9259),d=a(1657);let c=o.fC;o.ZA;let u=o.B4,f=o.JO,p=r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,n.jsxs)(o.xz,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...l,children:[r,(0,n.jsx)(f,{asChild:!0,children:(0,n.jsx)(i.Z,{className:"h-4 w-4 opacity-50"})})]})});p.displayName=o.xz.displayName;let m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(o.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,n.jsx)(l.Z,{className:"h-4 w-4"})})});m.displayName=o.u_.displayName;let g=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(o.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,n.jsx)(i.Z,{className:"h-4 w-4"})})});g.displayName=o.$G.displayName;let h=r.forwardRef((e,t)=>{let{className:a,children:r,position:i="popper",...l}=e;return(0,n.jsx)(o.h_,{children:(0,n.jsxs)(o.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:i,...l,children:[(0,n.jsx)(m,{}),(0,n.jsx)(o.l_,{className:(0,d.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,n.jsx)(g,{})]})})});h.displayName=o.VY.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(o.__,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...r})}).displayName=o.__.displayName;let x=r.forwardRef((e,t)=>{let{className:a,children:r,...i}=e;return(0,n.jsxs)(o.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...i,children:[(0,n.jsx)(o.eT,{children:r}),(0,n.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(o.wU,{children:(0,n.jsx)(s.Z,{className:"h-4 w-4"})})})]})});x.displayName=o.ck.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(o.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",a),...r})}).displayName=o.Z0.displayName},5400:function(e,t,a){a.d(t,{aM:function(){return c},ue:function(){return m},yo:function(){return d}});var n=a(7437),r=a(2265),o=a(2936),i=a(7742),l=a(2235),s=a(1657);let d=o.fC,c=o.xz;o.x8;let u=o.h_,f=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(o.aV,{className:(0,s.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:t})});f.displayName=o.aV.displayName;let p=(0,i.j)("fixed z-50 gap-4 bg-background p-6 shadow-xl transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-200 data-[state=open]:duration-200",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),m=r.forwardRef((e,t)=>{let{side:a="right",className:r,children:i,...d}=e;return(0,n.jsxs)(u,{children:[(0,n.jsx)(f,{}),(0,n.jsxs)(o.VY,{ref:t,className:(0,s.cn)(p({side:a}),r),...d,children:[i,(0,n.jsxs)(o.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,n.jsx)(l.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=o.VY.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(o.Dx,{ref:t,className:(0,s.cn)("text-lg font-semibold text-foreground",a),...r})}).displayName=o.Dx.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(o.dk,{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",a),...r})}).displayName=o.dk.displayName},1657:function(e,t,a){a.d(t,{cn:function(){return o},t:function(){return i}});var n=a(3167),r=a(1367);function o(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.m6)((0,n.W)(t))}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";let a=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,a)).toFixed(t<0?0:t))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][a]}},970:function(e,t,a){a.d(t,{q:function(){return m}});var n=a(4318),r=a(2558),o=a(7014),i=a(3606),l=a(1231),s=a(7656),d=a(5249),c={Group:{input:{required:{}},output:[],output_name:[],name:"Group",category:"utils"},Reroute:{input:{required:{"*":["*"]}},output:["*"],output_name:[],name:"Reroute",category:"utils"}},u=a(9326),f=a(6288);let p=["fixed","increment","decrement","randomize"],m=(0,s.Ue)()((0,d.mW)((e,t)=>({page:"flow",counter:0,widgets:{},customWidgets:Object.keys(c),graph:{},nodes:[],edges:[],queue:[],gallery:[],edgeType:r.v[2],nodeInProgress:void 0,promptError:void 0,clientId:void 0,onSetPage:t=>{e({page:t},!1,"onSetPage")},onNewClientId:t=>{e({clientId:t},!1,"onNewClientId")},onRefresh:async()=>{let t=await (0,n.aU)();e({widgets:{...c,...t}},!1,"onRefresh")},onInit:async()=>{await (0,n.Z1)(),setInterval(()=>t().onPersistTemp(),5e3);let a=await (0,n.Gw)(),i=await (0,n.aU)();e({widgets:{...c,...i}},!1,"onInit"),t().onLoadWorkflow((0,o.Vj)());let l=r.v[parseInt(a["Comfy.LinkRenderMode"])];t().onEdgesType(l,!1)},onCreateGroup:()=>{let{nodes:a,onDetachGroup:n}=t(),r=a.filter(e=>e.selected).map(e=>n(e));if(r.length<1)return;let{left:i,right:s,top:d,bottom:u}=r.reduce((e,t)=>{let{position:{x:a,y:n},width:r,height:o}=t;return{left:Math.min(e.left,a),right:Math.max(e.right,a+Number(r)),top:Math.min(e.top,n),bottom:Math.max(e.bottom,n+Number(o))}},{left:1/0,right:0,top:1/0,bottom:0}),f={widget:c.Group,position:{x:i-40,y:d-60},width:s-i+80,height:u-d+100,key:(0,l.Z)()};e(e=>(0,o.gz)(e,f),!1,"onCreateGroup")},onSetNodesGroup:(t,a)=>{e(e=>({nodes:e.nodes.map(e=>t.includes(e.id)?e.parentNode===a.id?e:{...e,parentNode:a.id,position:{x:e.position.x-a.position.x,y:e.position.y-a.position.y}}:e.parentNode===a.id?{...e,parentNode:void 0,position:{x:e.position.x+a.position.x,y:e.position.y+a.position.y}}:e)}))},onDetachGroup:e=>{if(!e.parentNode)return e;let a=t().nodes.find(t=>t.id===e.parentNode);return{...e,parentNode:void 0,position:{x:e.position.x+Number(null==a?void 0:a.position.x),y:e.position.y+Number(null==a?void 0:a.position.y)}}},onDetachNodesGroup:(t,a)=>{e(e=>({nodes:e.nodes.map(e=>t.includes(e.id)?{...e,parentNode:void 0,position:{x:e.position.x+a.position.x,y:e.position.y+a.position.y}}:e)}))},onNodesChange:t=>{e(e=>({nodes:(0,i.Fb)(t,e.nodes)}),!1,"onNodesChange")},onUpdateNodes:(t,a)=>{e(e=>({nodes:(0,o.tV)(t,a,e.nodes)}),!1,"onUpdateNodes")},onAddNode:t=>{e(e=>(0,o.gz)(e,t),!1,"onAddNode")},onDeleteNode:a=>{let{nodes:n,onDetachNodesGroup:r}=t(),o=n.find(e=>e.id===a);r(n.filter(e=>e.parentNode===a).map(e=>e.id),o),e(e=>({nodes:(0,i.Fb)([{type:"remove",id:a}],e.nodes)}),!1,"onDeleteNode")},onDuplicateNode:t=>{e(e=>{let{graph:a,nodes:n,widgets:r}=e,i=a[t],l=n.find(e=>e.id===t),s=null==l?void 0:l.position,d=s?{...s,y:s.y+(l.height||100)+24}:void 0,c={widget:r[i.widget],node:i,position:d,...(null==l?void 0:l.width)&&{width:l.width},...(null==l?void 0:l.height)&&{height:l.height}};return(0,o.gz)(e,c)},!1,"onDuplicateNode")},onNodeInProgress:(t,a)=>{e({nodeInProgress:{id:t,progress:a}},!1,"onNodeInProgress")},onPropChange:(t,a,n)=>{e(e=>{var r;e.onUpdateNodes(t,{[a]:n});let o={...null===(r=e.graph[t])||void 0===r?void 0:r.fields,[a]:n},i={...e.graph[t],fields:o},l={...e.graph,[t]:i};return{...e,graph:l}},!1,"onPropChange")},onModifyChange:(t,a,n)=>{e(e=>({nodes:e.nodes.map(e=>e.id===t?{...e,data:{...e.data,[a]:n}}:e)}))},onGetNodeFieldsData:(e,a)=>{try{var n,r;return null===(r=t())||void 0===r?void 0:null===(n=r.graph[e])||void 0===n?void 0:n.fields[a]}catch(e){console.error(e)}},onCopyNode:()=>{let{nodes:e}=t(),a=e.filter(e=>e.selected).map(e=>e.id),n=(0,o.Mg)(t());return{data:a.reduce((t,a)=>{let r=n.data[a];if(r.parentNode){let n=e.find(e=>e.id===r.parentNode);t[a]={...r,parentNode:void 0,position:{x:r.position.x+Number(null==n?void 0:n.position.x),y:r.position.y+Number(null==n?void 0:n.position.y)}}}else t[a]=r;return t},{}),connections:n.connections.filter(e=>a.includes(e.target)&&a.includes(e.source))}},onPasteNode:(t,a)=>{let n=(0,o.ug)(Object.values(t.data).map(e=>e.position)),{data:r,idMap:i}=(0,o.Xl)(t,n,a),l=(0,o.$V)(t,i),s={data:r,...l};e(e=>Object.entries(s.data).reduce((e,t)=>{let[a,n]=t,r=e.widgets[n.value.widget];return r?(0,o.gz)(e,{widget:r,node:n.value,position:n.position,width:n.width,height:n.height,parentNode:n.parentNode,key:a}):(console.warn("Unknown widget ".concat(n.value.widget)),e)},l.connections.reduce(o.HE,e)),!0,"onPasteNode")},expanded:[],onExpand:a=>{let{expanded:n,graph:r}=t();if(a)e({expanded:n.includes(a)?n.filter(e=>e!==a):[...n,a]});else{let t=Object.keys(r);e({expanded:n.length!==t.length?t:[]})}},onEdgesChange:t=>{e(e=>({edges:(0,i.yn)(t,e.edges)}),!1,"onEdgesChange")},onEdgesAnimate:t=>{e(e=>({edges:e.edges.map(e=>({...e,animated:t}))}),!1,"onEdgesAnimate")},onUpdateFrontend:async()=>{await (0,n.wt)("Comfy.Frontend","classic"),window.location.reload()},onEdgesType:async function(t){let a=!(arguments.length>1)||void 0===arguments[1]||arguments[1],o=t.name;e(e=>({edgeType:t,edges:e.edges.map(e=>({...e,type:o}))}),!1,"onEdgesType"),a&&await (0,n.wt)("Comfy.LinkRenderMode",r.v.indexOf(t))},onConnect:t=>{console.log("onConnect",t),e(e=>(0,o.HE)(e,t),!1,"onConnect")},onImageSave:(t,a)=>{e(e=>({gallery:e.gallery.concat(a.map(e=>({image:e}))),graph:{...e.graph,[t]:{...e.graph[t],images:a}}}),!1,"onImageSave")},onSubmit:async()=>{let a=t(),r=(0,o.Mg)(a);e({promptError:(await (0,n.u3)((0,n.Fh)({graph:r,widgets:a.widgets,customWidgets:a.customWidgets,clientId:a.clientId}))).error,counter:a.counter+1},!1,"onSubmit")},onDeleteFromQueue:async e=>{await (0,n.bu)(e),await t().onQueueUpdate()},onQueueUpdate:async()=>{},onPersistTemp:()=>{(0,o.aA)((0,o.Mg)(t()))},onSaveLocalWorkFlow:e=>{(0,o.Eo)((0,o.Mg)(t()),e)},onLoadLocalWorkflow:e=>{let a=(0,o._h)(e);a?t().onLoadWorkflow(a):t().onLoadWorkflow(u.Z)},onUpdateLocalWorkFlowGraph:e=>{(0,o.iq)(e,{graph:(0,o.Mg)(t())})},onUpdateLocalWorkFlowTitle:(e,t)=>{(0,o.iq)(e,{title:t})},onLoadWorkflow:a=>{if(console.log("[onLoadWorkflow] Received workflow:",a),!a){console.error("[onLoadWorkflow] Invalid workflow data");return}let n=a.data?a:function(e,t){console.log("inputJson.links:",e.links);let a={data:{},connections:[]},n={},r=[];if(e.nodes.forEach(e=>{let o="node-".concat(e.id);n[e.id]=o;let i=t[e.type];if(!i){r.push(e.type);return}let l={widget:e.type,fields:{},modify:{}};if(e.properties&&e.properties["Node name for S&R"]&&(l.modify={nickname:e.properties["Node name for S&R"]}),i.input&&e.widgets_values){let t={...i.input.required,...i.input.optional},a=Object.keys(t),n=0,r=0;for(;n<e.widgets_values.length&&r<a.length;){let o=e.widgets_values[n];if(p.includes(o)){n++;continue}let i=a[r],s=t[i];Array.isArray(s)&&(s.length>1||1===s.length&&Array.isArray(s[0]))&&(l.fields[i]=o,n++),r++}}a.data[o]={value:l,position:{x:e.pos[0],y:e.pos[1]},width:e.size[0],height:e.size[1]},e.parentNode&&(a.data[o].parentNode="node-".concat(e.parentNode))}),Array.isArray(e.links)&&e.links.forEach(t=>{let r=t[1],o=t[3],i=n[r],l=n[o],s=e.nodes.find(e=>e.id===r),d=e.nodes.find(e=>e.id===o);if(s&&d){let e=t[2],n=s.outputs[e],r=t[4],o=d.inputs[r];if(n&&o){let e={source:i,sourceHandle:n.name,target:l,targetHandle:o.name};a.connections.push(e)}}}),r.length>0){let e=r.join(", ");f.Am.error("The following node types are missing:",{description:"".concat(e)})}return a}(a,t().widgets);console.log("Transformed workflow:",n),e(e=>{let{widgets:t}=e,a={...e,nodes:[],edges:[],counter:0,graph:{}};return Object.entries(n.data).forEach(e=>{let[n,r]=e;if(!r.value){console.warn("[onLoadWorkflow] Node value is undefined or null for key: ".concat(n));return}let i=null==t?void 0:t[r.value.widget];i?a=(0,o.gz)(a,{widget:i,node:r.value,position:r.position,width:r.width,height:r.height,key:n,parentNode:r.parentNode}):console.warn("[onLoadWorkflow] Unknown widget: ".concat(r.value.widget))}),n.connections?n.connections.forEach(e=>{a=(0,o.HE)(a,e)}):console.warn("[onLoadWorkflow] Workflow connections is undefined or null"),a},!0,"onLoadWorkflow")},onDownloadWorkflow:()=>{(0,o.Cq)((0,o.Mg)(t()))}})))},2558:function(e,t,a){a.d(t,{v:function(){return o}});var n=a(7437),r=a(2177);let o=[{icon:(0,n.jsx)(r.FZO,{}),name:"step"},{icon:(0,n.jsx)(r.fOV,{}),name:"linear"},{icon:(0,n.jsx)(r.ecD,{}),name:"spline"}]},7014:function(e,t,a){a.d(t,{HE:function(){return o},gz:function(){return m},lj:function(){return d},W:function(){return R},$V:function(){return w},Xl:function(){return y},Sf:function(){return E},l9:function(){return P},_h:function(){return L},yY:function(){return h},rf:function(){return x},ug:function(){return v},Sk:function(){return O},qW:function(){return S},Vj:function(){return F},Eo:function(){return M},aA:function(){return I},Mg:function(){return C},iq:function(){return _},tV:function(){return g},Cq:function(){return Z}});var n=a(6624),r=a(3606);let o=(e,t)=>{let{edges:a}=e,{targetHandle:n,target:o}=t;return{...e,edges:(0,r.Z_)(t,a.filter(e=>!(e.targetHandle===n&&e.target===o)))}},i=e=>e.edges.flatMap(e=>{let{source:t,sourceHandle:a,target:n,targetHandle:r}=e;return(null==a?void 0:a.length)&&(null==r?void 0:r.length)?[{source:t,sourceHandle:a,target:n,targetHandle:r}]:[]});var l=a(6816);class s{isBool(e){return!!(0,l.Z)(e)&&"BOOL"===e[0]}isInt(e){return!!(0,l.Z)(e)&&"INT"===e[0]}isFloat(e){return!!(0,l.Z)(e)&&"FLOAT"===e[0]}isString(e){return!!(0,l.Z)(e)&&"STRING"===e[0]}isList(e){return!!(0,l.Z)(e)&&Array.isArray(e[0])}isParameterOrList(e){return!!(0,l.Z)(e)&&(this.isBool(e)||this.isInt(e)||this.isFloat(e)||this.isString(e)||this.isList(e))}}let d=new s;var c=a(6042),u=a(1231);let f=e=>{let t={};return Object.entries(e.input.required).forEach(e=>{var a,n,r;let[o,i]=e;d.isBool(i)?t[o]=null!==(a=i[1].default)&&void 0!==a&&a:d.isFloat(i)?t[o]=null!==(n=i[1].default)&&void 0!==n?n:0:d.isInt(i)?t[o]=null!==(r=i[1].default)&&void 0!==r?r:0:d.isString(i)?t[o]="":d.isList(i)&&(t[o]=i[0][0])}),t},p=e=>({widget:e.name,fields:f(e)}),m=(e,t)=>{var a;let{widget:n,node:o,position:i={x:0,y:0},width:l,height:s,key:d,parentNode:f}=t,m=String(null!=d?d:(0,u.Z)()),g=e.nodes.map(e=>{var t;return null!==(t=e.zIndex)&&void 0!==t?t:0}).concat([0]).reduce((e,t)=>Math.max(e,t))+1,h={id:m,type:c.f,data:{...n,...null!==(a=null==o?void 0:o.modify)&&void 0!==a?a:{}},dragHandle:".drag-handle",position:i,zIndex:g,width:l,height:s,parentNode:f,style:{width:l,height:s}};return{...e,nodes:(0,r.Fb)([{type:"add",item:h}],e.nodes),graph:{...e.graph,[m]:null!=o?o:p(n)}}},g=(e,t,a)=>a.map(a=>(a.id===e&&(a.data={...a.data,...t}),a)),h=(e,t,a,n)=>{let r=a.current.getBoundingClientRect();return n.project({x:e-r.left,y:t-r.top})},x=(e,t)=>{let{x:a,y:n,zoom:r}=t.getViewport();return{x:Math.floor((e.current.offsetWidth/2-a)/r),y:Math.floor((e.current.offsetHeight/2-n)/r)}},v=e=>{let t=e[0];for(let a=1;a<e.length;a++){let n=e[a];(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n)}return t},b=(e,t,a)=>({...e,position:{x:Math.floor(e.position.x-t.x+a.x),y:Math.floor(e.position.y-t.y+a.y)},key:(0,u.Z)()}),y=(e,t,a)=>Object.entries(e.data).reduce((e,n)=>{let[r,o]=n,i=b(o,t,a);return{data:{...e.data,[i.key]:i},idMap:{...e.idMap,[r]:i.key}}},{data:{},idMap:{}}),w=(e,t)=>({connections:e.connections.map(e=>({...e,source:t[e.source],target:t[e.target]}))});var N=a(9326);let j="civitui-flow-temp",k="civitui-flow-local",C=e=>{let t={};return e.nodes.forEach(a=>{let n=e.graph[a.id];void 0!==n&&(t[a.id]={value:n,position:a.position},a.width&&(t[a.id].width=a.width),a.height&&(t[a.id].height=a.height),a.parentNode&&(t[a.id].parentNode=a.parentNode))}),{data:t,connections:i(e)}},R=()=>{try{localStorage.removeItem(j)}catch(e){console.log("[cleanTempWorkflow]",e)}},F=()=>{let e=localStorage.getItem(j);return e===JSON.stringify({data:{},connections:[]})&&(localStorage.removeItem(j),e=null),e?JSON.parse(e):N.Z},I=e=>{try{localStorage.setItem(j,JSON.stringify(e))}catch(e){console.log("[saveTempWorkflow]",e)}},S=()=>{try{let e=localStorage.getItem(k);return e?JSON.parse(e):[]}catch(e){return console.log("[retrieveLocalWorkflows]",e),[]}},L=e=>{let t=S().find(t=>t.id===e);return t?t.graph:null},E=e=>{try{let t=S().map(t=>t.id!==e&&t).filter(Boolean);localStorage.setItem(k,JSON.stringify(t))}catch(e){console.log("[deleteLocalWorkflowFromId]",e)}},M=(e,t)=>{try{let a=S(),n=new Date().getTime();a.push({title:t||"Local-".concat(n),time:n,id:"comfyui-".concat(n,"-").concat(Math.floor(1e6*Math.random())),graph:e}),localStorage.setItem(k,JSON.stringify(a))}catch(e){console.log("[saveLocalWorkflow]",e)}},_=(e,t)=>{try{let a=S().map(a=>a.id!==e?a:{...a,...t,time:new Date().getTime()});localStorage.setItem(k,JSON.stringify(a))}catch(e){console.log("[updateLocalWorkflow]",e)}},O=(e,t)=>{try{let a=new FileReader;e&&(console.log("[readWorkflowFromFile] Reading workflow file:",e.name),a.readAsText(e),a.addEventListener("load",e=>{var a;let n=null===(a=e.target)||void 0===a?void 0:a.result;if("string"==typeof n)try{console.log("[readWorkflowFromFile] File content:",n);let e=JSON.parse(n);console.log("[readWorkflowFromFile] Parsed workflow:",JSON.stringify(e,null,2));try{t(e)}catch(e){console.error("[readWorkflowFromFile] Error in callback:",e)}}catch(e){console.error("[readWorkflowFromFile] Error parsing workflow JSON:",e)}else console.warn("[readWorkflowFromFile] File content is not a string")}))}catch(e){console.log("[readWorkflowFromFile]",e)}},Z=(e,t)=>{let a=new Blob([JSON.stringify(e)],{type:"application/json"}),n=URL.createObjectURL(a),r=document.createElement("a");r.download=t?"".concat(t,".json"):"workflow.json",r.href=n,r.click(),URL.revokeObjectURL(n)};a(4318);let P=e=>"".concat(n.Z.protocol,"//").concat(n.Z.host).concat(e)}}]);